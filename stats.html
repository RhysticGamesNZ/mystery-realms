<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Your Profile â€“ Mystery Realms</title>
  <link href="https://fonts.googleapis.com/css2?family=IM+Fell+English&display=swap&family=Cormorant+Garamond&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div id = "site-content">
   <header class="site-header">
  <div class="header-container">
    <div class="logo">
      <img src="./logo.png" alt="Mystery Realms Logo" />
    </div>
    <nav class="nav-links">
      <a href="index.html">Mystery</a>
      <a href="past.html">Past Mysteries</a>
      <a href="lore.html">Lore & Codex</a>
      <a href="stats.html">Stats</a>
      <a href="premium.html">Premium</a>
    </nav>
     <div class="hamburger" id="hamburger-icon">
      &#9776;
    </div>
  </div>
</header>

<div class="page-wrapper">
<div id="ad-left" class="ad-left">
  <ins class="adsbygoogle"
       style="display:block;width:120px;height:600px"
       data-ad-client="ca-pub-2795399173885321"
       data-ad-slot="1111111111"></ins>
</div>
    
  <main class="card parchment" id="auth-container">
    <h2 id="auth-title">Sign In or Create an Account</h2>
    <form id="auth-form">
      <label>Email:</label><br />
      <input type="email" id="auth-email" required /><br /><br />
      <label>Password:</label><br />
      <input type="password" id="auth-password" required /><br /><br />
      <button type="submit">Login or Create an account</button>
    </form>
    <p id="auth-error" style="color: darkred;"></p>
  </main>

  <main class="card parchment" id="profile-container" style="display: none;">
    <h2 id="prof-title">Welcome, <span id="user-level"></span></h2>
  <div class="profile-flex">
  <img class="user-image" src="./detective.png" alt="badge" />
  <div class="stats-info">
    <p><img class="stat-image" src=./fingerprint.png alt="fingerprint"><strong>Email:</strong> <span id="user-email"></span></p>
    <p><img class="stat-image" src="./agent.png" alt="detective"><strong>Premium:</strong> <span id="user-premium">Checking...</span></p>
    <p><img class="stat-image" src="./fire.png" alt="fire"><strong>Current Streak:</strong> <span id="user-streak">0</span></p>
    <p><img class="stat-image" src="./smoking-pipe.png" alt="pipe"><strong>Longest Streak:</strong> <span id="user-streaklong">0</span></p>
    <p><img class="stat-image" src="./search.png" alt="magnifying glass"><strong>Correct Guesses:</strong> <span id="user-correct">0</span></p>
    <p><img class="stat-image" src="./search.png" alt="magnifying glass"><strong>Incorrect Guesses:</strong> <span id="user-incorrect">0</span></p>
    <p><img class="stat-image" src="./book-(1).png" alt="book"><strong>Lore Pages Read:</strong> <span id="user-lore-read">0</span></p>
  </div>
</div>

    <button id="logout-btn">Log Out</button>
  </main>

    <div id="ad-right" class="ad-right">
  <ins class="adsbygoogle"
       style="display:block;width:120px;height:600px"
       data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
       data-ad-slot="2222222222"></ins>
</div>
</div>

  <div id="ad-bottom" class="ad-bottom">
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
       data-ad-slot="3333333333"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
</div>
 <footer class="footer">
    <p>&copy; Rhystic Games 2025</p>
   <a href='https://ko-fi.com/G2G81E6E2Y' target='_blank'><img height='36' style='border:0px;height:36px;' src='https://storage.ko-fi.com/cdn/kofi1.png?v=6' border='0' alt='Buy Me a Coffee at ko-fi.com' /></a>
  </footer>
</div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDXY7DEhinmbYLQ7zBRgEUJoc_eRsp-aNU",
      authDomain: "mystery-realms.firebaseapp.com",
      projectId: "mystery-realms",
      storageBucket: "mystery-realms.firebasestorage.app",
      messagingSenderId: "511471364499",
      appId: "1:511471364499:web:fbc7d813e9b8d28cf32066"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const authContainer = document.getElementById("auth-container");
    const profileContainer = document.getElementById("profile-container");

    const form = document.getElementById("auth-form");
    const emailInput = document.getElementById("auth-email");
    const passwordInput = document.getElementById("auth-password");
    const errorDisplay = document.getElementById("auth-error");

    form.onsubmit = async (e) => {
      e.preventDefault();
      const email = emailInput.value;
      const password = passwordInput.value;

      try {
        await signInWithEmailAndPassword(auth, email, password);
      } catch (err) {
        // If user doesn't exist, try creating one
        try {
          await createUserWithEmailAndPassword(auth, email, password);
          await setDoc(doc(db, "users", auth.currentUser.uid), {
            email: auth.currentUser.email,
            premium: false,
            level: "Apprentice Seeker",
            streak: 0,
            correct: 0,
            incorrect: 0,
            loreRead: 0
          });
        } catch (createErr) {
          errorDisplay.textContent = createErr.message;
        }
      }
    };

    document.getElementById("logout-btn").addEventListener("click", async () => {
      await signOut(auth);
      location.reload();
    });

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        authContainer.style.display = "none";
        profileContainer.style.display = "block";

        document.getElementById("user-email").textContent = user.email;

const userDoc = await getDoc(doc(db, "users", user.uid));
if (userDoc.exists()) {
  const data = userDoc.data();
  document.getElementById("user-level").textContent = data.level ?? "Seeker";
  document.getElementById("user-premium").textContent = data.premium ? "Yes" : "No";
  document.getElementById("user-streak").textContent = data.streak ?? 0;
  document.getElementById("user-correct").textContent = data.correct ?? 0;
  document.getElementById("user-incorrect").textContent = data.incorrect ?? 0;
  document.getElementById("user-lore-read").textContent = data.loreRead ?? 0;
}
 else {
          document.getElementById("user-premium").textContent = "Unknown";
        }
      } else {
        authContainer.style.display = "block";
        profileContainer.style.display = "none";
      }
    });
  </script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({});
  (adsbygoogle = window.adsbygoogle || []).push({});
  (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<script>
  document.getElementById("hamburger-icon").addEventListener("click", function () {
    const navLinks = document.querySelector(".nav-links");
    const logo = document.querySelector(".logo");

    navLinks.classList.toggle("active");

    if (navLinks.classList.contains("active")) {
      logo.style.display = "none";
    } else {
      logo.style.display = "block";
    }
  });
</script>

<script type="module" src="./hide-ads.js"></script>
  
</body>
</html>
